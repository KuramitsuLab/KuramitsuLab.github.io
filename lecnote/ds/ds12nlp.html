

<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>12. 自然言語処理にむけて &mdash; Python &amp; Data Science 2021  ドキュメント</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="prev" title="11. 深層学習と画像認識" href="ds11deep.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Python & Data Science 2021
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ds01intro.html">1. Python とデータサイエンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds02sympy.html">2. 計算はPythonにさせてしまおう</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds03numpy.html">3. NumPyとグラフ</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds04pandas.html">4. 表データとPandasを使いこなそう</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds05data.html">5. データの傾向をつかもう</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds06classfy.html">6. クラスタリングしてみよう</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds07reg.html">7. 回帰：線形近似から予測する</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds08ml.html">8. 機械学習とクラス分類問題</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds09ds.html">9. データ・サイエンティストへの道</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds10nw.html">10. ニューラル・ネットワーク</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds11deep.html">11. 深層学習と画像認識</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">12. 自然言語処理にむけて</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#形態素解析">12.1. 形態素解析</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#英語と日本語">12.1.1. 英語と日本語</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spaCy/GINZA">12.1.2. spaCy/GINZA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#アンケート分析">12.2. アンケート分析</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#コメントを眺める">12.2.1. コメントを眺める</a></li>
<li class="toctree-l3"><a class="reference internal" href="#単語レベルの解析">12.2.2. 単語レベルの解析</a></li>
<li class="toctree-l3"><a class="reference internal" href="#（寄り道）単語頻度の視覚化">12.2.3. （寄り道）単語頻度の視覚化</a></li>
<li class="toctree-l3"><a class="reference internal" href="#満足度の高いキーワード">12.2.4. 満足度の高いキーワード</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#文章のベクトル化">12.3. 文章のベクトル化</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#BOW">12.3.1. BOW</a></li>
<li class="toctree-l3"><a class="reference internal" href="#コサイン類似度">12.3.2. コサイン類似度</a></li>
<li class="toctree-l3"><a class="reference internal" href="#TF/IDF">12.3.3. TF/IDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#LSA">12.3.4. LSA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#単語分散表現">12.4. 単語分散表現</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#単語ベクトル">12.4.1. 単語ベクトル</a></li>
<li class="toctree-l3"><a class="reference internal" href="#文章ベクトル">12.4.2. 文章ベクトル</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#コースワーク">12.5. コースワーク</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python & Data Science 2021</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">12. </span>自然言語処理にむけて</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ds12nlp.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="自然言語処理にむけて">
<h1><span class="section-number">12. </span>自然言語処理にむけて<a class="headerlink" href="#自然言語処理にむけて" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>画像認識は、もともと画像データが多次元ベクトルで表現されており、 よく似た画像が近いベクトルで表現されるなど、機械学習で処理しやすい前提が整っていました。 一方、自然言語などのテキストは、文字コードが近くても意味が近いわけではありません。 自然言語を機械学習で処理するためには、 テキストの特徴量を多次元ベクトルでうまく表現することが鍵になります。</p>
<p><img alt="590d4b1bf8924607a35066d73eb281e9" class="no-scaled-link" src="https://stg2-cdn.go2senkyo.com/articles/wp-content/uploads/2015/07/0ec9a44365144d96fb771d83b7bcc02e.jpg" style="width: 40%;" /></p>
<p>最後のまとめとして、 自然言語処理を機械学習で扱う方法を考えていきましょう。</p>
<p><strong>モジュールの準備</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">japanize_matplotlib</span> <span class="c1">#matplotlibの日本語化</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="o">!</span>pip install japanize_matplotlib
    <span class="kn">import</span> <span class="nn">japanize_matplotlib</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="s2">&quot;IPAexGothic&quot;</span><span class="p">)</span> <span class="c1">#日本語フォント設定</span>

</pre></div>
</div>
</div>
<div class="section" id="形態素解析">
<h2><span class="section-number">12.1. </span>形態素解析<a class="headerlink" href="#形態素解析" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>言語における意味の基本単位は語 (word) です。まず、語を取り出す方法からみていきましょう。</p>
<div class="section" id="英語と日本語">
<h3><span class="section-number">12.1.1. </span>英語と日本語<a class="headerlink" href="#英語と日本語" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>自然言語処理は、言語の種類によって難しさや扱い方が異なります。</p>
<ul class="simple">
<li><p>(英語文) I bought a book</p></li>
<li><p>(日本語文) 私は本を買った</p></li>
</ul>
<p>英語は、空白で区切られたものを語と考えることができます。 したがって、Python の標準文字列ライブラリだけで、簡単に語を取り出すことができます。</p>
<p><strong>英語の字句解析</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;I bought a book&quot;</span>
<span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;I&#39;, &#39;bought&#39;, &#39;a&#39;, &#39;book&#39;]
</pre></div></div>
</div>
<p>日本語では、まず語の区切りを判定する必要があります。 しかし、この語の区切りを判定するのが<strong>かなりの難処理</strong>です。</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle"><strong>形態素解析ツール（ライブラリ）</strong></p>
<p>日本語文から、語の区切りを決定するツール（ライブラリ）</p>
</div>
</div>
<div class="section" id="spaCy/GINZA">
<h3><span class="section-number">12.1.2. </span>spaCy/GINZA<a class="headerlink" href="#spaCy/GINZA" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>spaCy は、Explosion AI 社の開発するオープンソースの自然言語処理ライブラリです。2019 年に、 リクルート AI 研究所と国立言語研究所の研究成果である <a class="reference external" href="https://megagonlabs.github.io/ginza/">GiNZA</a> が登場し、実用的な日本語処理が手軽に利用できるようになりました。</p>
<p>まずは、GiNZA の導入から始めましょう。<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">ginza</span></code> を入力するだけで、 形態素解析も含め、自然言語処理に必要なライブラリがまとめてインストールされます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install ginza
import pkg_resources, imp
imp.reload(pkg_resources)
</pre></div>
</div>
<p>SpaCy/GINZAは、各種自然言語処理をパイプライン化したツールになっています。パイプラインを調整することで、最終的な処理を切り替えることができます。</p>
<p>単純に形態素解析したいときは、次の通り、使います。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">spacy</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;ja_ginza&#39;</span><span class="p">)</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="s2">&quot;私は本を買った&quot;</span><span class="p">)</span> <span class="c1">#形態素解析</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">orth_</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">lemma_</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">pos_</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">tag_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 私 私 PRON 代名詞
1 は は ADP 助詞-係助詞
2 本 本 NOUN 名詞-普通名詞-一般
3 を を ADP 助詞-格助詞
4 買っ 買う VERB 動詞-一般
5 た た AUX 助動詞
</pre></div></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>プロパティ</p></th>
<th class="head"><p>情報</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">orth_</span></code></p></td>
<td><p>入力語</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">lemma_</span></code></p></td>
<td><p>原型</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pos_</span></code></p></td>
<td><p>品詞(Part of Speech)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tag_</span></code></p></td>
<td><p>品詞タグ</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">vector</span></code></p></td>
<td><p>単語ベクトル</p></td>
</tr>
</tbody>
</table>
<p>日本語文を単語単位に分割する関数<code class="docutils literal notranslate"><span class="pre">wakachi(s)</span></code>を定義しておきましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">wakachi</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">lemma_</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">]</span>  <span class="c1"># word.lemma_ は標準形</span>

<span class="nb">print</span><span class="p">(</span><span class="n">wakachi</span><span class="p">(</span><span class="s1">&#39;私は本を買った&#39;</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;私&#39;, &#39;は&#39;, &#39;本&#39;, &#39;を&#39;, &#39;買う&#39;, &#39;た&#39;]
</pre></div></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">(時間があったら）Let’s try</p>
<p>自然言語処理と形態素解析の良い練習問題は、「自然言語処理１００本ノック」にあります。</p>
<p><a class="reference external" href="http://www.cl.ecei.tohoku.ac.jp/nlp100/">http://www.cl.ecei.tohoku.ac.jp/nlp100/</a></p>
<p>Web上には、解説記事がたくさん掲載されていますので、参考にしながら解いてみると実力がつきます。</p>
</div>
</div>
</div>
<div class="section" id="アンケート分析">
<h2><span class="section-number">12.2. </span>アンケート分析<a class="headerlink" href="#アンケート分析" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>不動産屋による「まちづくりに関するアンケート」に基づいて、アンケート解析を試していきましょう。 アンケードには、アンケートの回答日、コメント自由記述形式、満足度(5段階評価: 1 不満 - 5 満足)が記載されています。</p>
<p><strong>データの取り寄せ</strong></p>
<p>本データは、下山らによる「Python 実践データ分析 100 本ノック」から講義用に編集したものを利用します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!wget https://KuramitsuLab.github.io/data/survey.csv
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;survey.csv&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span> <span class="c1">#最初の5行を表示</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>日付</th>
      <th>コメント</th>
      <th>満足度</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019/3/11</td>
      <td>駅前に若者が集まっている</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019/2/25</td>
      <td>スポーツできる場所があるのが良い</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019/2/18</td>
      <td>子育て支援が嬉しい</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019/4/9</td>
      <td>保育園に入れる（待機児童なし）</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019/1/6</td>
      <td>駅前商店街が寂しい</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="コメントを眺める">
<h3><span class="section-number">12.2.1. </span>コメントを眺める<a class="headerlink" href="#コメントを眺める" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>今まで、様々なデータを扱ってきましたが、 今回のデータは、自由記述形式のテキストが入っているのが特徴です。</p>
<p>まず、アンケート中のコメントの分量を把握してみましょう。 文字数を数えて、新しいカラム(<code class="docutils literal notranslate"><span class="pre">文字数</span></code>)を作って格納します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;文字数&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;コメント&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>日付</th>
      <th>コメント</th>
      <th>満足度</th>
      <th>文字数</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019/3/11</td>
      <td>駅前に若者が集まっている</td>
      <td>1</td>
      <td>12</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019/2/25</td>
      <td>スポーツできる場所があるのが良い</td>
      <td>5</td>
      <td>16</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019/2/18</td>
      <td>子育て支援が嬉しい</td>
      <td>5</td>
      <td>9</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019/4/9</td>
      <td>保育園に入れる（待機児童なし）</td>
      <td>4</td>
      <td>15</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019/1/6</td>
      <td>駅前商店街が寂しい</td>
      <td>2</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;文字数&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([12., 24., 22., 10.,  6.,  6.,  5.,  0.,  0.,  1.]),
 array([ 4. ,  8.6, 13.2, 17.8, 22.4, 27. , 31.6, 36.2, 40.8, 45.4, 50. ]),
 &lt;BarContainer object of 10 artists&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ds12nlp_15_1.svg" src="_images/ds12nlp_15_1.svg" /></div>
</div>
<p>以上に長いコメントがありますね。</p>
<p><strong>コメントの長さ順に並べ変えてみる</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;文字数&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>日付</th>
      <th>コメント</th>
      <th>満足度</th>
      <th>文字数</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>41</th>
      <td>2019/2/25</td>
      <td>特になし</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>69</th>
      <td>2019/1/4</td>
      <td>特になし</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2019/1/21</td>
      <td>道が綺麗</td>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2019/3/15</td>
      <td>夜道が暗い</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2019/2/20</td>
      <td>ゴミ処理が楽</td>
      <td>4</td>
      <td>6</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>62</th>
      <td>2019/3/19</td>
      <td>アンケートをちゃんと確認して街づくりに反映してくれている姿勢が良い</td>
      <td>5</td>
      <td>33</td>
    </tr>
    <tr>
      <th>56</th>
      <td>2019/4/13</td>
      <td>歩行者用信号が変わるのが早い。老人や子供の事を考えて設定してほしい</td>
      <td>2</td>
      <td>33</td>
    </tr>
    <tr>
      <th>44</th>
      <td>2019/2/28</td>
      <td>信号のない交差点が近くにあり事故が起きそうで怖い、信号を付けて欲しい。</td>
      <td>1</td>
      <td>35</td>
    </tr>
    <tr>
      <th>39</th>
      <td>2019/3/11</td>
      <td>変なおじさんに声を掛けられた事がある。警察の巡回をもっと強化してほしい</td>
      <td>1</td>
      <td>35</td>
    </tr>
    <tr>
      <th>43</th>
      <td>2019/3/11</td>
      <td>最近川の氾濫被害が大きく取り扱われているが、この町ではどのような氾濫防止を取っているか説明し...</td>
      <td>3</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
<p>86 rows × 4 columns</p>
</div></div>
</div>
</div>
<div class="section" id="単語レベルの解析">
<h3><span class="section-number">12.2.2. </span>単語レベルの解析<a class="headerlink" href="#単語レベルの解析" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>コメントから単語を抽出して、どのような単語が使われているか調べてみましょう。</p>
<ul class="simple">
<li><p>標準形変換: 活用のある単語（例. 「買った」）は、買うのように標準形に変換する</p></li>
<li><p><a class="reference external" href="https://mieruca-ai.com/ai/nlp-stopwords/#toc_2-1">ストップワード除外</a>: 解析の精度を上げるために不要な記号や単語を取り除く</p></li>
</ul>
<p>ここでは、動詞、形容詞、名詞だけに着目してみます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;コメント&quot;</span><span class="p">]:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="c1"># 動詞(VERB), 名詞(NOUN), 形容詞(ADJ)のみ抽出</span>
        <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s1">&#39;VERB&#39;</span> <span class="ow">or</span> <span class="n">word</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s1">&#39;NOUN&#39;</span> <span class="ow">or</span> <span class="n">word</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s1">&#39;ADJ&#39;</span><span class="p">:</span>
            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lemma_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span> <span class="c1">#先頭30語だけ</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
375
[&#39;駅前&#39;, &#39;若者&#39;, &#39;集まる&#39;, &#39;スポーツ&#39;, &#39;場所&#39;, &#39;ある&#39;, &#39;良い&#39;, &#39;子育て&#39;, &#39;支援&#39;, &#39;嬉しい&#39;, &#39;保育園&#39;, &#39;入れる&#39;, &#39;待機児童&#39;, &#39;なし&#39;, &#39;駅前&#39;, &#39;商店街&#39;, &#39;寂しい&#39;, &#39;生活&#39;, &#39;便利&#39;, &#39;遊ぶ&#39;, &#39;場所&#39;, &#39;ない&#39;, &#39;遊ぶ&#39;, &#39;場所&#39;, &#39;ない&#39;, &#39;商業&#39;, &#39;施設&#39;, &#39;出来る&#39;, &#39;欲しい&#39;, &#39;病院&#39;]
</pre></div></div>
</div>
<p>これで、コメント文の中で用いられている名詞と動詞をすべて取り出すことができました。 しかし、まだどれの単語が重要なのかわかりません。各単語の出現頻度を調べてみましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;words&quot;</span><span class="p">:</span><span class="n">words</span><span class="p">})</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
words
欲しい      15
ほしい      14
少ない       7
駅前        7
良い        6
         ..
大丈夫       1
奇麗        1
姿勢        1
子ども       1
高齢者       1
Length: 228, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="（寄り道）単語頻度の視覚化">
<h3><span class="section-number">12.2.3. </span>（寄り道）単語頻度の視覚化<a class="headerlink" href="#（寄り道）単語頻度の視覚化" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ワードクラウドは、テキストデータを視覚的に表現する方法です。ちょっと寄り道をして表示してみましょう。</p>
<p>まず、日本語フォントをインストールしておきます。（これがないと文字化けします。）</p>
<p><strong>Colab上でのIPA日本語フォントのインストール</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!apt-get -y install fonts-ipafont-gothic
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## !pip install wordcloud</span>

<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span>
<span class="n">fpath</span> <span class="o">=</span> <span class="s1">&#39;/usr/share/fonts/truetype/fonts-japanese-gothic.ttf&#39;</span>
<span class="c1">#fpath = &#39;fonts-japanese-gothic.ttf&#39;</span>
<span class="n">word_chain</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">,</span> <span class="n">font_path</span><span class="o">=</span><span class="n">fpath</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ds12nlp_23_0.svg" src="_images/ds12nlp_23_0.svg" /></div>
</div>
<p>これで不動産の満足度に影響を与えているキーワードが見えてきました。しかし、まだどのキーワードがプラスの評価なのか、マイナスの評価なのかわかりません。</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Let’s try</p>
<p>満足度の高いキーワードを抽出してみよう</p>
</div>
</div>
<div class="section" id="満足度の高いキーワード">
<h3><span class="section-number">12.2.4. </span>満足度の高いキーワード<a class="headerlink" href="#満足度の高いキーワード" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>今回のアンケート調査の素晴らしいことは、不動産の満足度が 5 段階評価で回答されている点です。 各キーワードとこの5段階評価を紐付けてみると、キーワードの満足度が見えて来るかもしれません。</p>
<p>コメント内の単語と満足度をペアにして取り出してみます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">text</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;コメント&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;満足度&quot;</span><span class="p">]):</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">pos_</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;VERB&#39;</span><span class="p">,</span> <span class="s1">&#39;NOUN&#39;</span><span class="p">,</span> <span class="s1">&#39;ADJ&#39;</span><span class="p">]:</span>
            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lemma_</span><span class="p">)</span>
            <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scores</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;駅前&#39;, &#39;若者&#39;, &#39;集まる&#39;, &#39;スポーツ&#39;, &#39;場所&#39;, &#39;ある&#39;, &#39;良い&#39;, &#39;子育て&#39;, &#39;支援&#39;, &#39;嬉しい&#39;, &#39;保育園&#39;, &#39;入れる&#39;, &#39;待機児童&#39;, &#39;なし&#39;, &#39;駅前&#39;, &#39;商店街&#39;, &#39;寂しい&#39;, &#39;生活&#39;, &#39;便利&#39;, &#39;遊ぶ&#39;, &#39;場所&#39;, &#39;ない&#39;, &#39;遊ぶ&#39;, &#39;場所&#39;, &#39;ない&#39;, &#39;商業&#39;, &#39;施設&#39;, &#39;出来る&#39;, &#39;欲しい&#39;, &#39;病院&#39;]
[1, 1, 1, 5, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 2, 2, 2, 3, 3, 3, 3, 3, 2, 2, 2, 3, 3, 3, 3, 4]
</pre></div></div>
</div>
<p>Pandas を使って表データにまとめておきましょう。<code class="docutils literal notranslate"><span class="pre">出現数</span></code>1回のカラムを作って、<code class="docutils literal notranslate"><span class="pre">groupby</span></code>してみましょう。満足度は平均値をとることにします。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">keyword</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;キーワード&quot;</span><span class="p">:</span> <span class="n">words</span><span class="p">,</span> <span class="s2">&quot;満足度&quot;</span><span class="p">:</span> <span class="n">scores</span><span class="p">,</span> <span class="s2">&quot;出現数&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)})</span>
<span class="n">keyword</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;キーワード&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;満足度&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="s1">&#39;出現数&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;出現数&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>満足度</th>
      <th>出現数</th>
    </tr>
    <tr>
      <th>キーワード</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>bbb</th>
      <td>2.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>暗い</th>
      <td>1.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>暮らせる</th>
      <td>5.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>最高</th>
      <td>5.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>有名</th>
      <td>3.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>良い</th>
      <td>4.833333</td>
      <td>6</td>
    </tr>
    <tr>
      <th>少ない</th>
      <td>1.142857</td>
      <td>7</td>
    </tr>
    <tr>
      <th>駅前</th>
      <td>1.428571</td>
      <td>7</td>
    </tr>
    <tr>
      <th>ほしい</th>
      <td>2.000000</td>
      <td>14</td>
    </tr>
    <tr>
      <th>欲しい</th>
      <td>2.200000</td>
      <td>15</td>
    </tr>
  </tbody>
</table>
<p>228 rows × 2 columns</p>
</div></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Let’s try</p>
<p>満足度の高いキーワードと満足度の低いキーワードのトップ 5を出してみよう</p>
</div>
<p>今回の分析は、出現頻度のあまりに低い単語を除外した方が良いです。このように、データサイエ ンティスト(分析者)のセンスで、結果は少し変わります。</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">極性辞書とセンティメント解析</p>
<p>極性辞書は、ある単語が一般的にネガティブなのか、ポジティブなのかを、-1（ネガティブ）から1（ポジティブ）までのスコアの形で表現したものです。</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.cl.ecei.tohoku.ac.jp/Open%20Resources_Japanese%20Sentiment%20Polarity%20Dictionary.html">日本語評価極性辞書</a>：東北大の乾・岡崎研究室が公開</p></li>
<li><p><a class="reference external" href="http://www.lr.pi.titech.ac.jp/~takamura/pndic_ja.html">単語感情極性対応表</a>：東工大の高村教授が公開</p></li>
</ul>
<p>センティメント分析などに便利です。（今回の満足を極性辞書と比較してみましょう。）</p>
</div>
</div>
</div>
<div class="section" id="文章のベクトル化">
<h2><span class="section-number">12.3. </span>文章のベクトル化<a class="headerlink" href="#文章のベクトル化" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>次は、いよいよ文章のベクトル化を考えていきます。</p>
<p>ポイントは、意味や内容が似ている文が近くなるようにベクトル化することです。 もともと、類似文章検索として研究されてきました技術になります。</p>
<p>まず、準備として、<code class="docutils literal notranslate"><span class="pre">わかち書き</span></code>されたカラムを作っておきましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;わかち書き&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;コメント&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wakachi</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>日付</th>
      <th>コメント</th>
      <th>満足度</th>
      <th>文字数</th>
      <th>わかち書き</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019/3/11</td>
      <td>駅前に若者が集まっている</td>
      <td>1</td>
      <td>12</td>
      <td>駅前 に 若者 が 集まる て いる</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019/2/25</td>
      <td>スポーツできる場所があるのが良い</td>
      <td>5</td>
      <td>16</td>
      <td>スポーツ できる 場所 が ある の が 良い</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019/2/18</td>
      <td>子育て支援が嬉しい</td>
      <td>5</td>
      <td>9</td>
      <td>子育て 支援 が 嬉しい</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019/4/9</td>
      <td>保育園に入れる（待機児童なし）</td>
      <td>4</td>
      <td>15</td>
      <td>保育園 に 入れる （ 待機児童 なし )</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019/1/6</td>
      <td>駅前商店街が寂しい</td>
      <td>2</td>
      <td>9</td>
      <td>駅前 商店街 が 寂しい</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="BOW">
<h3><span class="section-number">12.3.1. </span>BOW<a class="headerlink" href="#BOW" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><strong>BOW(Bag of Words)</strong> は最も古典的な文書の特徴量を捉えてベクトル化する手法です。 出現する単語の個数を <span class="math notranslate nohighlight">\(N\)</span> とすると、各コメント文は出現した単語には 1 を入れた <span class="math notranslate nohighlight">\(N\)</span> 次元のベクトルで表現します。</p>
<p>BOW のポイントは、文章の構造は全て無視し、「どの単語が含まれているか」だけに注目している点です。そして、一旦、コメント文をベクトルで表現できれば、<strong>コサイン類似度 (cosine similarity)</strong>を用いて、類似度を求めることができます。</p>
<p>BOW の原理は、難しくありません。sklearnモジュールの<code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code>を使って、楽に BOW を求めることができます。ただし、sklearn は、英語圏で開発されたライブラリなので、入力文は英単語のように空白で区 切られているという前提になっています。日本語は、形態素解析を使って前処理して、テキストを空白区切りの形式に変換しておく必要があります。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;わかち書き&#39;</span><span class="p">])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">()</span>
<span class="n">bags</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">bags</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[0 0 0 ... 0 0 0]
 [0 0 1 ... 0 0 0]
 [0 0 0 ... 0 0 0]
 ...
 [0 0 0 ... 0 0 0]
 [0 0 0 ... 0 0 0]
 [0 0 0 ... 0 0 0]]
</pre></div></div>
</div>
<p>Pandasで表データとマージして、コメントがどのようにベクトル化されたかみてみましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bags</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span><span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;コメント&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bbb</th>
      <th>あまり</th>
      <th>ある</th>
      <th>いる</th>
      <th>おじ</th>
      <th>お祭り</th>
      <th>から</th>
      <th>くる</th>
      <th>くれる</th>
      <th>けど</th>
      <th>...</th>
      <th>隣町</th>
      <th>集まる</th>
      <th>電話</th>
      <th>頻繁</th>
      <th>駅前</th>
      <th>駐車場</th>
      <th>駐輪場</th>
      <th>高い</th>
      <th>高速道路</th>
      <th>高齢者</th>
    </tr>
    <tr>
      <th>コメント</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>駅前に若者が集まっている</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>スポーツできる場所があるのが良い</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>子育て支援が嬉しい</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>保育園に入れる（待機児童なし）</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>駅前商店街が寂しい</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 237 columns</p>
</div></div>
</div>
<p>BOWは、単語の並びを無視しています。語順を無視すると重要な情報が飛んでしまいそうですが、不思議なことに類似文書検索では、十分精度がでます。</p>
</div>
<div class="section" id="コサイン類似度">
<h3><span class="section-number">12.3.2. </span>コサイン類似度<a class="headerlink" href="#コサイン類似度" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>コサイン類似度は、文書ベクトルの類似度を測る尺度としてよく使われます。 ベクトルの向きがどの程度同じ方向を向いているか？という指標で、<span class="math notranslate nohighlight">\(-1\)</span>～<span class="math notranslate nohighlight">\(1\)</span>の範囲をとります。</p>
<p>コサイン類似度を数式で記述すると以下のようになります。</p>
<div class="math notranslate nohighlight">
\[cos(\mathbf{x}, \mathbf{y})
= \frac{\mathbf{x} \cdot \mathbf{y}}{|\mathbf{x}| \cdot|\mathbf{y}|}
= \frac{\sum_{i=1}^{|V|} x_i y_i}{\sqrt{\sum_{i=1}^{|V|} x_i^2}
    \cdot \sqrt{\sum_{i=1}^{|V|} y_i^2}}\]</div>
<p><strong>なんかそろそろNumPyの方が読みやすくなってきましたね</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">cosine_similarity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span><span class="mf">0.1</span><span class="p">])</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.222</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9837126278799047
</pre></div></div>
</div>
<p>もちろん、skleranモジュールにもコサイン類似度のライブラリは含まれています。 こちらは、ユニバーサル関数バージョンになっているので気をつけましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">]])</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">]])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[0.98597181 0.44748449]
 [0.42427716 1.        ]]
</pre></div></div>
</div>
<p>実際に、「スポーツできる場所があるのが良い(index=1)」と類似しているコメントを探してみましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">print_sim</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">bags</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">vec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">top10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">similarity</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">top10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">similarity</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;コメント&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
<span class="n">print_sim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.0 スポーツできる場所があるのが良い
0.39999999999999997 ランニングとか運動できる場所が多い
0.3162277660168379 サイクリングコースが良い
0.25819888974716115 都内へのアクセスが良い
0.25819888974716115 遊ぶ場所がない
0.22360679774997896 市長が若くて活気がある
0.22360679774997896 消防団が活発で安心できる
0.19999999999999998 子どもが安全に遊ぶ場所がない
0.19999999999999998 歩道が広い道が多くて安心できる
0.19999999999999998 近くに公園があって住みやすい
</pre></div></div>
</div>
</div>
<div class="section" id="TF/IDF">
<h3><span class="section-number">12.3.3. </span>TF/IDF<a class="headerlink" href="#TF/IDF" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>BOW は、単語の出現を見るだけで、重要度を考慮に入れていません。</p>
<p>TF-IDF(Term Frequency-Inverse Document Freequency: 単語頻度-逆文書頻度) は、 よくある一般的な単語と<strong>特徴のある重要な単語</strong>の区別をつける指標です。</p>
<p><strong>単語 w が n 回現われるとき、TF(Term Frequence)</strong></p>
<div class="math notranslate nohighlight">
\[TF = \frac{n}{N}\]</div>
<p><strong>単語 w を含む文が d 個あるとき、IDF(Inverse Document Frequency)</strong></p>
<div class="math notranslate nohighlight">
\[IDF = - \log{\frac{d}{D}} = \log{\frac{D}{d}}\]</div>
<p>TF-IDF は、<span class="math notranslate nohighlight">\(TF\)</span> と <span class="math notranslate nohighlight">\(IDF\)</span> の積によって求まる。</p>
<div class="math notranslate nohighlight">
\[\mbox{TF-IDF} = \frac{n}{N} \log{\frac{D}{d}}\]</div>
<p>IDF は一種の一般語フィルタとして働き、多くの文書に出現する語(一般的な語)は重要度が下が り、特定の文書にしか出現しない単語の重要度を上げる役割を果たします。</p>
<p>TF/IDF を用いることで、重要度の重みつけされたベクトルが得られます。（本当は、自分で計算してみましょうとしたいのですが、）sklearn のライブラリを用いてお手軽に計算してみます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="c1"># tf-idf</span>

<span class="n">vectorizer</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">max_df</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span> <span class="c1">#文書全体の90%以上で出現する単語は無視する</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;わかち書き&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;feature_names:&#39;</span><span class="p">,</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
feature_names: [&#39;bbb&#39;, &#39;あまり&#39;, &#39;ある&#39;, &#39;いる&#39;, &#39;おじ&#39;, &#39;お祭り&#39;, &#39;から&#39;, &#39;くる&#39;, &#39;くれる&#39;, &#39;けど&#39;, &#39;この&#39;, &#39;ごみ&#39;, &#39;さん&#39;, &#39;すぎる&#39;, &#39;する&#39;, &#39;そう&#39;, &#39;たくさん&#39;, &#39;ちゃんと&#39;, &#39;つく&#39;, &#39;できる&#39;, &#39;とき&#39;, &#39;とても&#39;, &#39;どう&#39;, &#39;どのような&#39;, &#39;ない&#39;, &#39;なし&#39;, &#39;なる&#39;, &#39;なん&#39;, &#39;ひどい&#39;, &#39;ほしい&#39;, &#39;ます&#39;, &#39;まち&#39;, &#39;まで&#39;, &#39;もう&#39;, &#39;もっと&#39;, &#39;やすい&#39;, &#39;やめる&#39;, &#39;よう&#39;, &#39;よく&#39;, &#39;よる&#39;, &#39;られる&#39;, &#39;れる&#39;, &#39;アクセス&#39;, &#39;アンケート&#39;, &#39;ゴミ&#39;, &#39;サイクリングコース&#39;, &#39;サポート&#39;, &#39;スポット&#39;, &#39;スポーツ&#39;, &#39;スポーツジム&#39;, &#39;スーパー&#39;, &#39;デート&#39;, &#39;ナンバー&#39;, &#39;バス&#39;, &#39;ホームページ&#39;, &#39;マスコット&#39;, &#39;ママ&#39;, &#39;ランニング&#39;, &#39;リーズナブル&#39;, &#39;下さる&#39;, &#39;不便&#39;, &#39;不安&#39;, &#39;不正&#39;, &#39;並木&#39;, &#39;事件&#39;, &#39;事故&#39;, &#39;交差点&#39;, &#39;他県&#39;, &#39;付ける&#39;, &#39;企業&#39;, &#39;住む&#39;, &#39;作る&#39;, &#39;便利&#39;, &#39;保育園&#39;, &#39;信号&#39;, &#39;備蓄&#39;, &#39;働く&#39;, &#39;充実&#39;, &#39;先月&#39;, &#39;入る&#39;, &#39;入れる&#39;, &#39;公共&#39;, &#39;公園&#39;, &#39;公害&#39;, &#39;冬場&#39;, &#39;凍結&#39;, &#39;処理&#39;, &#39;出る&#39;, &#39;出張所&#39;, &#39;出来る&#39;, &#39;分かる&#39;, &#39;利用&#39;, &#39;利用料金&#39;, &#39;助かる&#39;, &#39;動物園&#39;, &#39;反映&#39;, &#39;取り扱う&#39;, &#39;取る&#39;, &#39;商店街&#39;, &#39;商業&#39;, &#39;喫茶店&#39;, &#39;土日&#39;, &#39;地域&#39;, &#39;場所&#39;, &#39;増やす&#39;, &#39;変わる&#39;, &#39;多い&#39;, &#39;夜道&#39;, &#39;夜間&#39;, &#39;大きい&#39;, &#39;大丈夫&#39;, &#39;大変&#39;, &#39;奇麗&#39;, &#39;姿勢&#39;, &#39;嬉しい&#39;, &#39;子ども&#39;, &#39;子供&#39;, &#39;子育て&#39;, &#39;安全&#39;, &#39;安心&#39;, &#39;家賃&#39;, &#39;寂しい&#39;, &#39;対応&#39;, &#39;対策&#39;, &#39;小学校&#39;, &#39;少し&#39;, &#39;少ない&#39;, &#39;屋根&#39;, &#39;巡回&#39;, &#39;市長&#39;, &#39;広い&#39;, &#39;強化&#39;, &#39;役所&#39;, &#39;待機児童&#39;, &#39;後押し&#39;, &#39;心配&#39;, &#39;怖い&#39;, &#39;急行&#39;, &#39;投稿&#39;, &#39;担当者&#39;, &#39;拡幅&#39;, &#39;掃除&#39;, &#39;掛ける&#39;, &#39;支援&#39;, &#39;料金&#39;, &#39;施設&#39;, &#39;早い&#39;, &#39;映画館&#39;, &#39;暗い&#39;, &#39;暮らせる&#39;, &#39;最近&#39;, &#39;最高&#39;, &#39;有名&#39;, &#39;校庭&#39;, &#39;桜並木&#39;, &#39;欲しい&#39;, &#39;止まる&#39;, &#39;歩行者&#39;, &#39;歩道&#39;, &#39;氾濫&#39;, &#39;活動&#39;, &#39;活性化&#39;, &#39;活気&#39;, &#39;活発&#39;, &#39;消防団&#39;, &#39;渋滞&#39;, &#39;災害&#39;, &#39;無い&#39;, &#39;無愛想&#39;, &#39;特に&#39;, &#39;状況&#39;, &#39;狭い&#39;, &#39;生活&#39;, &#39;病院&#39;, &#39;盛り上げる&#39;, &#39;相談&#39;, &#39;確認&#39;, &#39;糞害&#39;, &#39;細い&#39;, &#39;経路&#39;, &#39;綺麗&#39;, &#39;繋がる&#39;, &#39;老人&#39;, &#39;考える&#39;, &#39;職員&#39;, &#39;自治体&#39;, &#39;自然&#39;, &#39;自転車&#39;, &#39;良い&#39;, &#39;芝生&#39;, &#39;若い&#39;, &#39;若者&#39;, &#39;落ち葉&#39;, &#39;行く&#39;, &#39;行政&#39;, &#39;街づくり&#39;, &#39;街路樹&#39;, &#39;街頭&#39;, &#39;表示&#39;, &#39;被害&#39;, &#39;親身&#39;, &#39;観光&#39;, &#39;観光地&#39;, &#39;設定&#39;, &#39;詳細&#39;, &#39;説明&#39;, &#39;警察&#39;, &#39;豊か&#39;, &#39;走る&#39;, &#39;起きる&#39;, &#39;足りる&#39;, &#39;路地&#39;, &#39;路線&#39;, &#39;路面&#39;, &#39;近く&#39;, &#39;追加&#39;, &#39;遊び道具&#39;, &#39;遊ぶ&#39;, &#39;運動&#39;, &#39;過ごす&#39;, &#39;避難&#39;, &#39;都内&#39;, &#39;野良猫&#39;, &#39;開く&#39;, &#39;防止&#39;, &#39;防犯&#39;, &#39;降る&#39;, &#39;隣町&#39;, &#39;集まる&#39;, &#39;電話&#39;, &#39;頻繁&#39;, &#39;駅前&#39;, &#39;駐車場&#39;, &#39;駐輪場&#39;, &#39;高い&#39;, &#39;高速道路&#39;, &#39;高齢者&#39;]
X:
[[0.         0.         0.         ... 0.         0.         0.        ]
 [0.         0.         0.41652097 ... 0.         0.         0.        ]
 [0.         0.         0.         ... 0.         0.         0.        ]
 ...
 [0.         0.         0.         ... 0.         0.         0.        ]
 [0.         0.         0.         ... 0.         0.         0.        ]
 [0.         0.         0.         ... 0.         0.         0.        ]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span><span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;コメント&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bbb</th>
      <th>あまり</th>
      <th>ある</th>
      <th>いる</th>
      <th>おじ</th>
      <th>お祭り</th>
      <th>から</th>
      <th>くる</th>
      <th>くれる</th>
      <th>けど</th>
      <th>...</th>
      <th>隣町</th>
      <th>集まる</th>
      <th>電話</th>
      <th>頻繁</th>
      <th>駅前</th>
      <th>駐車場</th>
      <th>駐輪場</th>
      <th>高い</th>
      <th>高速道路</th>
      <th>高齢者</th>
    </tr>
    <tr>
      <th>コメント</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>駅前に若者が集まっている</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.397231</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.580016</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.411545</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>スポーツできる場所があるのが良い</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.416521</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>子育て支援が嬉しい</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>保育園に入れる（待機児童なし）</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>駅前商店街が寂しい</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.490089</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 237 columns</p>
</div></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Let’s try</p>
<p>TF/IDFの場合の類似コメントを探してみよう。</p>
</div>
</div>
<div class="section" id="LSA">
<h3><span class="section-number">12.3.4. </span>LSA<a class="headerlink" href="#LSA" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>LSA（潜在的意味解析）では、 トピックという文書と単語の間に存在する抽象的な概念を導入し、各文書の BOW あるいは TF-IDF ベクトルを行とする文書数×単語数の行列を特異値分解（SVD)し、文書数×トピック数に次元削減します。</p>
<p><strong>８次元に減らしてみます</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">TruncatedSVD</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># SVD</span>
<span class="n">svd</span> <span class="o">=</span> <span class="n">TruncatedSVD</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">svd</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">svd</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;コメント&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
    </tr>
    <tr>
      <th>コメント</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>駅前に若者が集まっている</th>
      <td>7.731770e-02</td>
      <td>0.055635</td>
      <td>0.221337</td>
      <td>0.258149</td>
      <td>-0.183296</td>
      <td>-0.000305</td>
      <td>0.136036</td>
      <td>-0.064076</td>
    </tr>
    <tr>
      <th>スポーツできる場所があるのが良い</th>
      <td>9.653416e-02</td>
      <td>0.232015</td>
      <td>0.242801</td>
      <td>-0.275236</td>
      <td>0.224877</td>
      <td>-0.002571</td>
      <td>0.282702</td>
      <td>0.372138</td>
    </tr>
    <tr>
      <th>子育て支援が嬉しい</th>
      <td>1.530323e-01</td>
      <td>0.241557</td>
      <td>-0.164930</td>
      <td>0.098121</td>
      <td>0.093775</td>
      <td>-0.002967</td>
      <td>-0.276363</td>
      <td>0.062022</td>
    </tr>
    <tr>
      <th>保育園に入れる（待機児童なし）</th>
      <td>1.993400e-07</td>
      <td>-0.000112</td>
      <td>0.000043</td>
      <td>0.000067</td>
      <td>-0.000063</td>
      <td>0.508183</td>
      <td>-0.004800</td>
      <td>0.000048</td>
    </tr>
    <tr>
      <th>駅前商店街が寂しい</th>
      <td>1.475882e-01</td>
      <td>-0.066456</td>
      <td>0.235868</td>
      <td>0.196006</td>
      <td>-0.265106</td>
      <td>0.001276</td>
      <td>-0.074943</td>
      <td>0.076161</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>小学校の校庭が芝生なのでとても良い</th>
      <td>3.357989e-02</td>
      <td>0.109346</td>
      <td>0.002445</td>
      <td>-0.019058</td>
      <td>0.079640</td>
      <td>0.002153</td>
      <td>0.071718</td>
      <td>0.297933</td>
    </tr>
    <tr>
      <th>ホームページからアンケートを投稿できるようにしてほしい</th>
      <td>2.061109e-01</td>
      <td>0.200964</td>
      <td>-0.030146</td>
      <td>-0.113776</td>
      <td>-0.090526</td>
      <td>-0.001596</td>
      <td>0.202042</td>
      <td>0.033840</td>
    </tr>
    <tr>
      <th>公園に遊び道具が少なすぎる</th>
      <td>1.735468e-01</td>
      <td>-0.023439</td>
      <td>0.093533</td>
      <td>0.130378</td>
      <td>-0.037278</td>
      <td>0.001100</td>
      <td>0.007060</td>
      <td>0.216022</td>
    </tr>
    <tr>
      <th>もっと公園を増やしてほしい</th>
      <td>5.883562e-01</td>
      <td>-0.202565</td>
      <td>-0.184834</td>
      <td>-0.231458</td>
      <td>-0.253843</td>
      <td>-0.003732</td>
      <td>-0.064550</td>
      <td>0.201424</td>
    </tr>
    <tr>
      <th>駅前に駐車場が少ない、不便</th>
      <td>1.226444e-01</td>
      <td>0.017410</td>
      <td>0.509561</td>
      <td>0.516643</td>
      <td>-0.314527</td>
      <td>-0.003270</td>
      <td>-0.066299</td>
      <td>0.261483</td>
    </tr>
  </tbody>
</table>
<p>86 rows × 8 columns</p>
</div></div>
</div>
<p>では、「スポーツできる場所があるのが良い(index=1)」と類似しているコメントをみてみましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">print_sim</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">top10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">similarity</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">top10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">similarity</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;コメント&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
<span class="n">print_sim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9999999999999998 スポーツできる場所があるのが良い
0.9704742874252414 ランニングとか運動できる場所が多い
0.9271749843766424 市長が若くて活気がある
0.8850136813887487 消防団が活発で安心できる
0.8794676152538797 歩道が広い道が多くて安心できる
0.8696169842692176 サイクリングコースが良い
0.8678878385469999 冬場、路面凍結で事故が多い、対応できませんか
0.8541713596444912 有名な企業が多い
0.836653242687093 隣町にできたごみ処理施設が心配、公害は大丈夫？
0.8337364715521739 都内へのアクセスが良い
</pre></div></div>
</div>
<p>参考資料： <a class="reference external" href="https://www.ogis-ri.co.jp/otc/hiroba/technical/similar-document-search/part1.html">https://www.ogis-ri.co.jp/otc/hiroba/technical/similar-document-search/part1.html</a></p>
</div>
</div>
<div class="section" id="単語分散表現">
<h2><span class="section-number">12.4. </span>単語分散表現<a class="headerlink" href="#単語分散表現" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>文書中の単語出現数を元に文書ベクトルを紹介してきましたが、最後に単語の持つ意味的な情報を用いる手法として、<strong>単語分散表現</strong>（単語ベクトル）について紹介します。</p>
<p>単語分散表現では、単語を多次元空間上の座標にマッピングすることで、単語同士の類似度を比較したり、加減算したりすることができるようになります。</p>
<p>単語分散表現は、さまざまな方法で求められます。 しかし、2013年にGoogle研究所が発表した Word2Vecが有名です。 これは、「同じ文脈で登場する単語は似た意味を持つ」という分布仮説をベースにして、ニューラルネットワークで計算されます。</p>
<div class="section" id="単語ベクトル">
<h3><span class="section-number">12.4.1. </span>単語ベクトル<a class="headerlink" href="#単語ベクトル" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>GiNZAは、形態素解析したときに単語ベクトルが<code class="docutils literal notranslate"><span class="pre">voctor</span></code>プロパティで付与されています。</p>
<p><strong>単語ベクトルを確認してみる</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="s1">&#39;スポーツ 良い&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="p">)</span> <span class="c1"># 「スポーツ」の単語ベクトル</span>
<span class="c1">#print(doc[1].vector.shape, doc[1].vector) # 「良い」の単語ベクトル</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(300,) [ 0.13375778 -0.17257443  0.02516939  0.1324365  -0.05213964  0.36968458
 -0.40936273  0.11759301 -0.01370322  0.16887937  0.25840095 -0.03895048
 -0.12300318 -0.16547137  0.14446233 -0.04904341 -0.38537306  0.2110346
 -0.22277047 -0.06400058 -0.21376547  0.0176675  -0.00410596 -0.01469426
 -0.02343989 -0.11121087  0.23225866  0.03399521  0.0003097  -0.17104886
 -0.05210022  0.04949599  0.24797468  0.25802103 -0.12333041  0.31917045
  0.17388728  0.2035169   0.06582559 -0.25228208  0.18981704  0.15296002
 -0.3062748  -0.13662805 -0.25415638  0.14236008  0.116825    0.00469154
 -0.05889941  0.07863956  0.4675573   0.06081422  0.2529209  -0.07001508
  0.34606618  0.2717276   0.25792852 -0.2984004  -0.07375812 -0.09873105
  0.14780869  0.0873313   0.10026332 -0.10008292 -0.3316018  -0.02629723
  0.5940275   0.30866838 -0.08813549 -0.32104307  0.03274322  0.10554635
 -0.30488187  0.377073   -0.0811692   0.20839754  0.38205898  0.02628802
  0.18617581  0.19931976  0.00599956  0.06431035  0.09854034  0.02887992
 -0.08011294 -0.03455874  0.08992771  0.06116451  0.19689974 -0.00615429
 -0.15785006 -0.01781378  0.00281635  0.34449962  0.09425399 -0.07273636
  0.1780002  -0.34851024  0.37838387 -0.13598311  0.2519176  -0.34066144
 -0.01075775 -0.14786543 -0.04548219 -0.02431995  0.10417668  0.11535702
 -0.09153163  0.01274134 -0.08331569 -0.07227844  0.10793906  0.01709241
 -0.33268264  0.03616779  0.18477437 -0.054786    0.11694523  0.2861517
 -0.1814767  -0.2492276  -0.3056511   0.10268316  0.02496759 -0.03885837
 -0.44996476 -0.13723636  0.02233196  0.01498503  0.19116491  0.02721791
 -0.09347356 -0.22418728  0.20053582 -0.02321318 -0.03963188  0.07721978
  0.3976757  -0.16255735 -0.2857601   0.01022803 -0.11282344 -0.03161858
  0.10372707 -0.04063642  0.13277282 -0.14350836  0.03758351  0.28988007
 -0.15129718 -0.07004785 -0.11414956  0.01055098 -0.2234786   0.20059532
 -0.10320012  0.06600995  0.10613239 -0.03008373 -0.34670264 -0.19242819
 -0.09134309 -0.03962347  0.30269867  0.24795845 -0.05786613 -0.08064044
  0.33049724 -0.35176003 -0.0745642  -0.14381081 -0.19127265 -0.2308729
  0.10868629  0.12795904  0.26682377  0.39642188  0.25173983  0.06555948
  0.08945418  0.28307387 -0.20416422  0.20722027 -0.35040206  0.11971842
 -0.22560261 -0.09891736  0.20061518 -0.01337475 -0.05774496  0.07784817
  0.0190405  -0.03751906 -0.27015632  0.02247851 -0.05720989  0.20762147
  0.27350608  0.13747151 -0.00919761  0.10923077 -0.33616212  0.08090062
  0.09826039  0.13366058 -0.08271509  0.3381954   0.13788582 -0.06729469
 -0.09151109  0.14015338 -0.14572589  0.29161888  0.02844842  0.07236236
 -0.033314   -0.16876915 -0.09799793 -0.01827359  0.31428993 -0.06787148
 -0.04007914  0.1423875   0.24909684  0.07624617 -0.31010824  0.24325818
 -0.04150698 -0.04732224  0.4020983  -0.13875155 -0.3239038  -0.08643212
  0.13847236 -0.09768677 -0.20165052 -0.27315557 -0.43414918  0.12716582
  0.40271717  0.11295483 -0.06921897 -0.02047522  0.05772358 -0.20754315
  0.27045983 -0.3403588  -0.28104421 -0.04287485  0.16783538 -0.05046352
 -0.02322021  0.80653805 -0.49147975  0.14961116  0.02781115 -0.13225512
 -0.05151397 -0.43092707 -0.01291704  0.200752    0.5579526  -0.02965733
 -0.2158913   0.04157935  0.33107662  0.19664446 -0.275344   -0.35029644
  0.15709329 -0.046059   -0.47471583 -0.05245955 -0.32224137  0.12703025
 -0.07285262 -0.40086585 -0.0947476   0.15882298  0.35492867 -0.2662322
 -0.26684946  0.06684791 -0.17897451 -0.06707234 -0.10908245  0.13751653
 -0.38477394 -0.21492186 -0.08163136 -0.12800853  0.42276528 -0.02782323
 -0.03355124  0.0600879  -0.08807893  0.10318359  0.11266886 -0.12545823]
(300,) [ 0.13375778 -0.17257443  0.02516939  0.1324365  -0.05213964  0.36968458
 -0.40936273  0.11759301 -0.01370322  0.16887937  0.25840095 -0.03895048
 -0.12300318 -0.16547137  0.14446233 -0.04904341 -0.38537306  0.2110346
 -0.22277047 -0.06400058 -0.21376547  0.0176675  -0.00410596 -0.01469426
 -0.02343989 -0.11121087  0.23225866  0.03399521  0.0003097  -0.17104886
 -0.05210022  0.04949599  0.24797468  0.25802103 -0.12333041  0.31917045
  0.17388728  0.2035169   0.06582559 -0.25228208  0.18981704  0.15296002
 -0.3062748  -0.13662805 -0.25415638  0.14236008  0.116825    0.00469154
 -0.05889941  0.07863956  0.4675573   0.06081422  0.2529209  -0.07001508
  0.34606618  0.2717276   0.25792852 -0.2984004  -0.07375812 -0.09873105
  0.14780869  0.0873313   0.10026332 -0.10008292 -0.3316018  -0.02629723
  0.5940275   0.30866838 -0.08813549 -0.32104307  0.03274322  0.10554635
 -0.30488187  0.377073   -0.0811692   0.20839754  0.38205898  0.02628802
  0.18617581  0.19931976  0.00599956  0.06431035  0.09854034  0.02887992
 -0.08011294 -0.03455874  0.08992771  0.06116451  0.19689974 -0.00615429
 -0.15785006 -0.01781378  0.00281635  0.34449962  0.09425399 -0.07273636
  0.1780002  -0.34851024  0.37838387 -0.13598311  0.2519176  -0.34066144
 -0.01075775 -0.14786543 -0.04548219 -0.02431995  0.10417668  0.11535702
 -0.09153163  0.01274134 -0.08331569 -0.07227844  0.10793906  0.01709241
 -0.33268264  0.03616779  0.18477437 -0.054786    0.11694523  0.2861517
 -0.1814767  -0.2492276  -0.3056511   0.10268316  0.02496759 -0.03885837
 -0.44996476 -0.13723636  0.02233196  0.01498503  0.19116491  0.02721791
 -0.09347356 -0.22418728  0.20053582 -0.02321318 -0.03963188  0.07721978
  0.3976757  -0.16255735 -0.2857601   0.01022803 -0.11282344 -0.03161858
  0.10372707 -0.04063642  0.13277282 -0.14350836  0.03758351  0.28988007
 -0.15129718 -0.07004785 -0.11414956  0.01055098 -0.2234786   0.20059532
 -0.10320012  0.06600995  0.10613239 -0.03008373 -0.34670264 -0.19242819
 -0.09134309 -0.03962347  0.30269867  0.24795845 -0.05786613 -0.08064044
  0.33049724 -0.35176003 -0.0745642  -0.14381081 -0.19127265 -0.2308729
  0.10868629  0.12795904  0.26682377  0.39642188  0.25173983  0.06555948
  0.08945418  0.28307387 -0.20416422  0.20722027 -0.35040206  0.11971842
 -0.22560261 -0.09891736  0.20061518 -0.01337475 -0.05774496  0.07784817
  0.0190405  -0.03751906 -0.27015632  0.02247851 -0.05720989  0.20762147
  0.27350608  0.13747151 -0.00919761  0.10923077 -0.33616212  0.08090062
  0.09826039  0.13366058 -0.08271509  0.3381954   0.13788582 -0.06729469
 -0.09151109  0.14015338 -0.14572589  0.29161888  0.02844842  0.07236236
 -0.033314   -0.16876915 -0.09799793 -0.01827359  0.31428993 -0.06787148
 -0.04007914  0.1423875   0.24909684  0.07624617 -0.31010824  0.24325818
 -0.04150698 -0.04732224  0.4020983  -0.13875155 -0.3239038  -0.08643212
  0.13847236 -0.09768677 -0.20165052 -0.27315557 -0.43414918  0.12716582
  0.40271717  0.11295483 -0.06921897 -0.02047522  0.05772358 -0.20754315
  0.27045983 -0.3403588  -0.28104421 -0.04287485  0.16783538 -0.05046352
 -0.02322021  0.80653805 -0.49147975  0.14961116  0.02781115 -0.13225512
 -0.05151397 -0.43092707 -0.01291704  0.200752    0.5579526  -0.02965733
 -0.2158913   0.04157935  0.33107662  0.19664446 -0.275344   -0.35029644
  0.15709329 -0.046059   -0.47471583 -0.05245955 -0.32224137  0.12703025
 -0.07285262 -0.40086585 -0.0947476   0.15882298  0.35492867 -0.2662322
 -0.26684946  0.06684791 -0.17897451 -0.06707234 -0.10908245  0.13751653
 -0.38477394 -0.21492186 -0.08163136 -0.12800853  0.42276528 -0.02782323
 -0.03355124  0.0600879  -0.08807893  0.10318359  0.11266886 -0.12545823]
</pre></div></div>
</div>
</div>
<div class="section" id="文章ベクトル">
<h3><span class="section-number">12.4.2. </span>文章ベクトル<a class="headerlink" href="#文章ベクトル" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>文章ベクトルは、単語ベクトルから算出されます。</p>
<p>この算出方法は色々あります。GiNZAでは、各単語の平均値ベクトルとして算出されるようです。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="s1">&#39;ポーツできる場所があるのが良い&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">vector</span><span class="p">)</span> <span class="c1"># 単語ベクトル</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(300,) [-0.02920693 -0.05320758 -0.0522105  -0.08731095 -0.03517435 -0.02590578
  0.00206362 -0.1063849  -0.09927486 -0.04500962  0.04499383 -0.06481141
 -0.0288375   0.04145418 -0.11855906 -0.13537505 -0.07372829 -0.005988
 -0.1166847   0.00200363 -0.07982864  0.0653679  -0.02242133  0.03441318
 -0.09967872 -0.10132443 -0.17745972 -0.00701735 -0.01890183 -0.02232861
  0.00425247 -0.09943429  0.1189977   0.11469252 -0.01476635 -0.00565097
 -0.08678276  0.08944558 -0.06026531  0.01860928  0.07967254  0.03719408
 -0.0694015  -0.03305633 -0.04918492 -0.06143166 -0.00042069  0.01650344
 -0.12821096  0.01242355 -0.01574672  0.02855304 -0.01309349  0.06785982
  0.02561383  0.0167272  -0.02429795 -0.01248624 -0.05111359 -0.00523373
 -0.03138427  0.03268416  0.03163368  0.00560306  0.00034257 -0.06571576
  0.12110818  0.18030974  0.10791279  0.01394656  0.0255538   0.07066533
  0.013614    0.06444446 -0.05641092  0.04407748  0.03320919  0.0004552
  0.02246881 -0.01736393 -0.07054626 -0.07443018 -0.01807081  0.02475807
  0.02234626  0.00154515  0.00551776  0.00626367  0.07205774  0.00634133
 -0.00399228  0.00767399 -0.03283146  0.07159147  0.06482697  0.10085686
  0.09856593 -0.04808494  0.03084285  0.00029174  0.00425797 -0.0495946
  0.11755088 -0.06460506 -0.04854925 -0.07223612  0.09228191  0.09676455
  0.07876915  0.02307541  0.06704701 -0.07946542 -0.00074483 -0.02177041
  0.018668   -0.12127856  0.07543771 -0.02609853  0.08425374  0.02380007
 -0.10355288 -0.09578987  0.01285531 -0.08888882  0.09946763 -0.00273043
 -0.04580917  0.03583116  0.05751135 -0.00427228 -0.08011837 -0.09800892
 -0.06978434 -0.07361989 -0.03381431 -0.0487395   0.02674628  0.0191588
  0.00247293 -0.08118343 -0.09112532  0.01042639  0.01473123  0.03303504
  0.0201649   0.00025361 -0.04324289  0.04405454  0.04665114  0.01007584
 -0.0546068  -0.08137256  0.0397726  -0.02145665 -0.21151868  0.14583382
 -0.08519368 -0.07310313 -0.04868405  0.05399269  0.02925398 -0.01777376
 -0.04635568  0.0677426  -0.03870093 -0.03328982 -0.1661798   0.07733109
  0.02625116 -0.07757658  0.05397995  0.01525526  0.00298676  0.06089411
  0.03646235 -0.01055191  0.080689    0.10871259  0.07923553  0.02947542
 -0.07205083 -0.0860265  -0.08119814  0.07206785  0.02596396  0.0130357
  0.0931971   0.04475599  0.02308878  0.01526667  0.03803923  0.02801875
 -0.06903288  0.05913321 -0.05807992  0.04792631 -0.0087816  -0.09529499
  0.01481394 -0.01695308  0.04447183 -0.07569    -0.07110366 -0.03407736
 -0.04950442  0.07128353 -0.03751003  0.02298016  0.13305187  0.02586973
 -0.10390261  0.01455116  0.07440154  0.05090108  0.00680628  0.0967969
 -0.02308619  0.00649277 -0.02494653 -0.00940593  0.04059135 -0.00369758
  0.03812422  0.06031455  0.06031232 -0.0071035  -0.02450604  0.01896761
  0.03082364  0.01141291  0.01425576  0.01331456 -0.06570377  0.1441507
  0.02328368  0.06463818 -0.11780812  0.07823002  0.0098581   0.02152279
  0.06506702 -0.04175583 -0.12819394 -0.01864348 -0.00585906  0.07083139
 -0.05241846 -0.07188665 -0.05962841  0.06958519  0.01034061 -0.0433907
 -0.03215906  0.02310069 -0.17440806  0.09636591  0.00652586 -0.04734528
  0.02170709 -0.12133204  0.09089412 -0.0492343   0.04126725  0.02021465
 -0.0496464  -0.08032804 -0.09103935 -0.06628747  0.06904414 -0.10683578
  0.09802075  0.12269397 -0.08747786  0.02755496 -0.05856017  0.03572648
  0.00165045 -0.03348825  0.0763365   0.04421256  0.01006745 -0.05442426
  0.06049172 -0.02185039 -0.0914305  -0.09839067  0.0950931  -0.02670297
  0.00542849  0.00232094 -0.06282385  0.02534583  0.01359846 -0.03921163
  0.01357794  0.10529844 -0.10408807 -0.03580856 -0.03502506 -0.02003236]
</pre></div></div>
</div>
<p>このような文書ベクトルを使うことでも文書類似度検索を行うことができます。</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Let’s try</p>
<p>GiNZA の文書ベクトルを用いて、コサイン類似度から類似度検索をしてみよう。 TF/IDF と比較してみると面白いかも..</p>
</div>
<p>現在の自然言語処理では、TransformerによるBERTと呼ばれる文脈を含んだ ベクトル化が発明されて、人工知能や機械翻訳の精度が大きく向上しています。 さらに詳しく勉強したい人は、一緒に研究しましょう。</p>
</div>
</div>
<div class="section" id="コースワーク">
<h2><span class="section-number">12.5. </span>コースワーク<a class="headerlink" href="#コースワーク" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>今回のアンケートでは、自由形式のコメントと満足度を同時に回答するようになっていたため、満 足度の高いキーワードを抽出できました。また、コメント文をベクトル化することで、コメント間 の類似度が求められることも見えてきました。</p>
<div class="admonition tip"><p><strong>疑問（文書分類）</strong></p>
<p>満足度は予測できるのでしょうか?</p>
</div><p>これは、エントリーシートから(採用後の)満足度は予想できるのでしょうか?と同じ質問になります。 皆さんは AI がエントリーシートを判定しているという噂を聞いたことがありますね。</p>
<div class="admonition tip"><p><strong>演習（エントリシート）</strong></p>
<p>企業がどのように AI を活用して、エントリーシートを分析しているか考察してみよう。 （可能であれば、今回のコメント文から満足度を予測するモデルを構築してみよう。）</p>
</div><p>今まで学んできた知識を総動員して、もし足りなかったら追加で調査して考えてみましょう。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="ds11deep.html" class="btn btn-neutral float-left" title="11. 深層学習と画像認識" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 著作権 2021, 倉光君郎(Kimio Kuramitsu)

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>